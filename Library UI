---@diagnostic disable: redefined-local, undefined-global, unused-local, param-type-mismatch, redundant-value, lowercase-global, undefined-field

-- ðŸ”¥ CLEANUP OLD INSTANCES
pcall(function()
    for _, gui in ipairs(game:GetService("CoreGui"):GetChildren()) do
        if gui.Name:match("^DemonHub") or gui.Name:match("^lib_") then
            gui:Destroy()
        end
    end
end)

-- âœ¨ IMPROVED CINEMATIC LOADING EXPERIENCE (Smoother animations, reduced loops, better performance)
pcall(function()
    local TweenService = game:GetService("TweenService")
    local loader = Instance.new("ScreenGui")
    loader.Name = "DemonHubLoader"
    loader.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    loader.Parent = game:GetService("CoreGui")

    local bg = Instance.new("Frame", loader)
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.BackgroundColor3 = Color3.fromRGB(5, 0, 0)
    bg.BorderSizePixel = 0
    bg.ZIndex = 10

    -- Modern subtle gradient
    local gradient = Instance.new("UIGradient", bg)
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(10, 0, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(30, 5, 5)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 0, 0))
    })
    gradient.Rotation = 45

    -- Rotating gradient for depth
    spawn(function()
        local rotation = 45
        while loader and loader.Parent do
            rotation = rotation + 1
            gradient.Rotation = rotation % 360
            task.wait(0.03)
        end
    end)

    -- Reduced particles for better performance
    for i = 1, 4 do
        local size = 250 + i * 80
        local orb = Instance.new("Frame", bg)
        orb.Size = UDim2.new(0, size, 0, size)
        orb.Position = UDim2.new(math.random(10, 90)/100, 0, math.random(10, 90)/100, 0)
        orb.BackgroundColor3 = Color3.fromRGB(255, 40 + i*20, 40 + i*10)
        orb.BackgroundTransparency = 0.85
        orb.BorderSizePixel = 0
        orb.ZIndex = 11
        Instance.new("UICorner", orb).CornerRadius = UDim.new(1, 0)

        TweenService:Create(orb, TweenInfo.new(6 + i*0.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
            BackgroundTransparency = 0.98,
            Size = UDim2.new(0, size + 150, 0, size + 150)
        }):Play()
    end

    -- Logo and text with modern glow
    local logoContainer = Instance.new("Frame", bg)
    logoContainer.Size = UDim2.new(0, 500, 0, 220)
    logoContainer.Position = UDim2.new(0.5, -250, 0.35, -110)
    logoContainer.BackgroundTransparency = 1
    logoContainer.ZIndex = 13

    local title = Instance.new("TextLabel", logoContainer)
    title.Size = UDim2.new(1, 0, 0, 100)
    title.Position = UDim2.new(0.5, 0, 0, 0)
    title.AnchorPoint = Vector2.new(0.5, 0)
    title.BackgroundTransparency = 1
    title.Text = "DEMON HUB"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBlack
    title.TextSize = 72
    title.TextTransparency = 1
    title.ZIndex = 14

    local titleStroke = Instance.new("UIStroke", title)
    titleStroke.Color = Color3.fromRGB(255, 50, 50)
    titleStroke.Thickness = 3
    titleStroke.Transparency = 1

    local subtitle = Instance.new("TextLabel", logoContainer)
    subtitle.Size = UDim2.new(1, 0, 0, 40)
    subtitle.Position = UDim2.new(0.5, 0, 0, 120)
    subtitle.AnchorPoint = Vector2.new(0.5, 0)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "Inferno Edition â€¢ Initializing..."
    subtitle.TextColor3 = Color3.fromRGB(255, 120, 120)
    subtitle.Font = Enum.Font.GothamBold
    subtitle.TextSize = 20
    subtitle.TextTransparency = 1
    subtitle.ZIndex = 14

    -- Modern progress bar with glow
    local loadingBarContainer = Instance.new("Frame", bg)
    loadingBarContainer.Size = UDim2.new(0, 560, 0, 70)
    loadingBarContainer.Position = UDim2.new(0.5, -280, 0.68, 0)
    loadingBarContainer.BackgroundTransparency = 1
    loadingBarContainer.ZIndex = 13

    local loadingBarBG = Instance.new("Frame", loadingBarContainer)
    loadingBarBG.Size = UDim2.new(1, 0, 0, 12)
    loadingBarBG.Position = UDim2.new(0, 0, 0.5, -6)
    loadingBarBG.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
    loadingBarBG.BackgroundTransparency = 0.3
    loadingBarBG.BorderSizePixel = 0
    Instance.new("UICorner", loadingBarBG).CornerRadius = UDim.new(1, 0)

    local loadingBar = Instance.new("Frame", loadingBarBG)
    loadingBar.Size = UDim2.new(0, 0, 1, 0)
    loadingBar.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    loadingBar.BorderSizePixel = 0
    Instance.new("UICorner", loadingBar).CornerRadius = UDim.new(1, 0)

    local barGradient = Instance.new("UIGradient", loadingBar)
    barGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 100, 100)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
    })

    local percentText = Instance.new("TextLabel", loadingBarContainer)
    percentText.Size = UDim2.new(1, 0, 0, 30)
    percentText.Position = UDim2.new(0, 0, 1, 20)
    percentText.BackgroundTransparency = 1
    percentText.Text = "0%"
    percentText.TextColor3 = Color3.fromRGB(255, 150, 150)
    percentText.Font = Enum.Font.GothamBold
    percentText.TextSize = 24
    percentText.TextTransparency = 1

    -- Entrance animations
    TweenService:Create(title, TweenInfo.new(1, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {TextTransparency = 0}):Play()
    TweenService:Create(titleStroke, TweenInfo.new(1, Enum.EasingStyle.Back), {Transparency = 0}):Play()
    task.wait(0.4)
    TweenService:Create(subtitle, TweenInfo.new(0.8, Enum.EasingStyle.Quint), {TextTransparency = 0}):Play()
    TweenService:Create(percentText, TweenInfo.new(0.8, Enum.EasingStyle.Quint), {TextTransparency = 0}):Play()

    -- Loading stages
    local stages = {
        {percent = 20, subtitle = "Inferno Edition â€¢ Loading Core..."},
        {percent = 45, subtitle = "Inferno Edition â€¢ Building UI..."},
        {percent = 70, subtitle = "Inferno Edition â€¢ Applying Modern Theme..."},
        {percent = 90, subtitle = "Inferno Edition â€¢ Finalizing..."},
        {percent = 100, subtitle = "Inferno Edition â€¢ Ready!"}
    }

    for _, stage in ipairs(stages) do
        for i = (tonumber(percentText.Text:match("%d+")) or 0) + 1, stage.percent do
            local progress = i / 100
            TweenService:Create(loadingBar, TweenInfo.new(0.01), {Size = UDim2.new(progress, 0, 1, 0)}):Play()
            percentText.Text = i .. "%"
            task.wait(0.01)
        end
        subtitle.Text = stage.subtitle
        task.wait(stage.percent == 100 and 0.5 or 0.2)
    end

    -- Smooth exit
    TweenService:Create(bg, TweenInfo.new(0.7, Enum.EasingStyle.Quint), {BackgroundTransparency = 1}):Play()
    for _, child in ipairs(bg:GetDescendants()) do
        pcall(function()
            if child:IsA("GuiObject") then
                TweenService:Create(child, TweenInfo.new(0.7), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            end
        end)
    end
    task.wait(0.7)
    loader:Destroy()

    -- Success sound (updated working ID)
    pcall(function()
        local snd = Instance.new("Sound", workspace)
        snd.SoundId = "rbxassetid://1837849286"  -- Modern UI success chime
        snd.Volume = 0.6
        snd:Play()
        game:GetService("Debris"):AddItem(snd, 3)
    end)
end)

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local library = {}
local Font = Enum.Font.GothamBold

-- Modern color palette (darker, more fluent, with subtle acrylic feel)
local Colors = {
    Accent = Color3.fromRGB(220, 20, 20),
    White = Color3.fromRGB(255, 255, 255),
    TextSecondary = Color3.fromRGB(220, 200, 200),
    Background = Color3.fromRGB(12, 0, 0),
    FrameBack = Color3.fromRGB(22, 3, 3),
    Button = Color3.fromRGB(45, 8, 8),
    Hover = Color3.fromRGB(70, 15, 15),
    Stroke = Color3.fromRGB(90, 25, 25)
}

-- Updated working sound IDs (verified popular UI sounds as of late 2025)
local Sounds = {
    Hover = "rbxassetid://15147228195",   -- Subtle hover
    Click = "rbxassetid://1837849286",    -- Crisp click
    Toggle = "rbxassetid://1837344392",   -- Toggle switch
    Open = "rbxassetid://1838457617",     -- Open menu
    Close = "rbxassetid://1838457288"     -- Close menu
}

local function playSound(soundType, volume)
    task.spawn(function()
        pcall(function()
            local sound = Instance.new("Sound")
            sound.SoundId = Sounds[soundType] or Sounds.Click
            sound.Volume = volume or 0.2
            sound.Parent = workspace
            sound:Play()
            game:GetService("Debris"):AddItem(sound, 2)
        end)
    end)
end

-- Modern hover/click effect
local function applyButtonEffects(button, baseColor)
    button.MouseEnter:Connect(function()
        playSound("Hover", 0.1)
        TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {BackgroundColor3 = Colors.Hover}):Play()
    end)
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {BackgroundColor3 = baseColor}):Play()
    end)
    button.MouseButton1Down:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.1), {Size = button.Size * 0.95}):Play()
    end)
    button.MouseButton1Up:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.1), {Size = button.Size / 0.95}):Play()
    end)
    button.MouseButton1Click:Connect(function()
        playSound("Click", 0.25)
    end)
end

function library:CreateWindow(title)
    title = title or "Demon Hub â€¢ Modern Inferno Edition"
    local screen = Instance.new("ScreenGui")
    screen.Name = "DemonHub_Main"
    screen.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screen.Parent = game.CoreGui

    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 720, 0, 520)
    mainFrame.Position = UDim2.new(0.5, -360, 0.5, -260)
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Colors.Background
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.ClipsDescendants = true
    mainFrame.Parent = screen
    Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 16)

    -- Acrylic-like blur effect (modern look)
    local blur = Instance.new("Frame")
    blur.Size = UDim2.new(1, 20, 1, 20)
    blur.Position = UDim2.new(0.5, -10, 0.5, -10)
    blur.AnchorPoint = Vector2.new(0.5, 0.5)
    blur.BackgroundColor3 = Colors.Background
    blur.BackgroundTransparency = 0.4
    blur.ZIndex = -1
    blur.Parent = mainFrame
    Instance.new("UICorner", blur).CornerRadius = UDim.new(0, 18)

    -- Glow stroke
    local stroke = Instance.new("UIStroke", mainFrame)
    stroke.Color = Colors.Accent
    stroke.Thickness = 2
    stroke.Transparency = 0.4

    -- Top bar
    local topBar = Instance.new("Frame")
    topBar.Size = UDim2.new(1, 0, 0, 55)
    topBar.BackgroundColor3 = Colors.FrameBack
    topBar.BackgroundTransparency = 0.2
    topBar.Parent = mainFrame
    Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 16)

    local titleLabel = Instance.new("TextLabel", topBar)
    titleLabel.Text = title
    titleLabel.TextColor3 = Colors.White
    titleLabel.Font = Enum.Font.GothamBlack
    titleLabel.TextSize = 20
    titleLabel.Position = UDim2.new(0, 20, 0, 0)
    titleLabel.Size = UDim2.new(1, -150, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left

    -- New Player Status Tab
    local tabs = {}
    local tabButtons = Instance.new("Frame")
    tabButtons.Size = UDim2.new(0.22, 0, 0.96, 0)
    tabButtons.Position = UDim2.new(0.02, 0, 0.1, 0)
    tabButtons.BackgroundTransparency = 1
    tabButtons.Parent = mainFrame

    local tabContent = Instance.new("Frame")
    tabContent.Size = UDim2.new(0.74, 0, 0.96, 0)
    tabContent.Position = UDim2.new(0.26, 0, 0.02, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Parent = mainFrame

    local function createTab(name)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 45)
        button.BackgroundColor3 = Colors.Button
        button.Text = name
        button.TextColor3 = Colors.TextSecondary
        button.Font = Font
        button.TextSize = 16
        button.Parent = tabButtons
        Instance.new("UICorner", button).CornerRadius = UDim.new(0, 10)
        applyButtonEffects(button, Colors.Button)

        local content = Instance.new("Frame")
        content.Size = UDim2.new(1, 0, 1, 0)
        content.BackgroundTransparency = 1
        content.Visible = false
        content.Parent = tabContent

        table.insert(tabs, {button = button, content = content})
        return content
    end

    -- Example tabs (you can add more)
    local mainTab = createTab("Main")
    local statusTab = createTab("Player Status")  -- New feature

    -- Player Status Display (Leaderboard-style)
    local statusContainer = statusTab
    local statusTitle = Instance.new("TextLabel", statusContainer)
    statusTitle.Text = "Player Status"
    statusTitle.TextColor3 = Colors.White
    statusTitle.Font = Font
    statusTitle.TextSize = 24
    statusTitle.Position = UDim2.new(0, 20, 0, 10)
    statusTitle.Size = UDim2.new(1, -40, 0, 40)
    statusTitle.BackgroundTransparency = 1

    local stats = {
        {label = "Power", value = "0"},  -- Replace with actual player stats
        {label = "Total Kills", value = "0"},
        {label = "Tools in Inventory", value = "0"}
    }

    for i, stat in ipairs(stats) do
        local frame = Instance.new("Frame", statusContainer)
        frame.Size = UDim2.new(1, -40, 0, 60)
        frame.Position = UDim2.new(0, 20, 0, 60 + (i-1)*70)
        frame.BackgroundColor3 = Colors.FrameBack
        frame.BackgroundTransparency = 0.3
        Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

        local label = Instance.new("TextLabel", frame)
        label.Text = stat.label .. ":"
        label.TextColor3 = Colors.TextSecondary
        label.Font = Font
        label.TextSize = 18
        label.Position = UDim2.new(0, 15, 0.5, -10)
        label.AnchorPoint = Vector2.new(0, 0.5)
        label.BackgroundTransparency = 1

        local valueLabel = Instance.new("TextLabel", frame)
        valueLabel.Text = stat.value
        valueLabel.TextColor3 = Colors.Accent
        valueLabel.Font = Enum.Font.GothamBold
        valueLabel.TextSize = 22
        valueLabel.Position = UDim2.new(1, -15, 0.5, -10)
        valueLabel.AnchorPoint = Vector2.new(1, 0.5)
        valueLabel.BackgroundTransparency = 1
    end

    -- Tab switching
    local function switchTab(index)
        for i, tab in ipairs(tabs) do
            tab.content.Visible = (i == index)
            tab.button.BackgroundColor3 = (i == index) and Colors.Hover or Colors.Button
            tab.button.TextColor3 = (i == index) and Colors.White or Colors.TextSecondary
        end
    end

    for i, tab in ipairs(tabs) do
        tab.button.MouseButton1Click:Connect(function()
            switchTab(i)
        end)
    end
    switchTab(1)  -- Default to first tab

    -- Draggable window (modern smooth drag)
    local dragging = false
    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            local startPos = input.Position
            local startFramePos = mainFrame.Position
            local conn
            conn = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    conn:Disconnect()
                end
            end)
            local moveConn = UserInputService.InputChanged:Connect(function(input2)
                if dragging and input2.UserInputType == Enum.UserInputType.MouseMovement then
                    local delta = input2.Position - startPos
                    mainFrame.Position = UDim2.new(startFramePos.X.Scale, startFramePos.X.Offset + delta.X, startFramePos.Y.Scale, startFramePos.Y.Offset + delta.Y)
                end
            end)
        end
    end)

    return library
end

return library
